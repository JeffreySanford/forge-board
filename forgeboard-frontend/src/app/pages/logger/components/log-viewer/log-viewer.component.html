<div class="log-viewer-container">
  <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z0">
    <!-- Timestamp Column -->
    <ng-container matColumnDef="timestamp">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Timestamp</th>
      <td mat-cell *matCellDef="let log">{{ log.timestamp | date:'medium' }}</td>
    </ng-container>

    <!-- Level Column -->
    <ng-container matColumnDef="level">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Level</th>
      <td mat-cell *matCellDef="let log">
        <span class="level-badge" [ngClass]="getLevelClass(log.level)">
          {{ log.level | uppercase }}
        </span>
      </td>
    </ng-container>

    <!-- Source Column -->
    <ng-container matColumnDef="source">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Source</th>
      <td mat-cell *matCellDef="let log">{{ log.source }}</td>
    </ng-container>

    <!-- Message Column -->
    <ng-container matColumnDef="message">
      <th mat-header-cell *matHeaderCellDef>Message</th>
      <td mat-cell *matCellDef="let log">{{ log.message }}</td>
    </ng-container>
    
    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let log">
        <button mat-icon-button color="primary" (click)="toggleDetails(log)" [attr.aria-label]="'Toggle details for log ' + log.id">
          <mat-icon>{{ expandedLog === log ? 'expand_less' : 'expand_more' }}</mat-icon>
        </button>
      </td>
    </ng-container>
    
    <!-- Expanded Content Column -->
    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let log" [attr.colspan]="displayedColumns.length">
        <div class="expanded-detail" [@detailExpand]="expandedLog === log ? 'expanded' : 'collapsed'">
          <div *ngIf="expandedLog === log">
            <h4>Log Details</h4>
            <pre>{{ formatDetails(log.details) }}</pre>
          </div>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr mat-row *matRowDef="let log; columns: displayedColumns;"
        [class.expanded-row]="expandedLog === log"
        (click)="toggleDetails(log)"></tr>
    <tr mat-row *matRowDef="let log; columns: ['expandedDetail']; when: expandedLog === log"
        class="detail-row"></tr>
  </table>

  <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]"
                  showFirstLastButtons 
                  aria-label="Select page of logs">
  </mat-paginator>
  
  <div *ngIf="logs.length === 0" class="no-logs-message">
    <mat-icon>article</mat-icon>
    <p>No logs found matching your criteria</p>
  </div>
</div>
